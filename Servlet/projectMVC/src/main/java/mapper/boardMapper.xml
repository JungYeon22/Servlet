<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardSQL">
  	<insert id="insertBoard" parameterType="map">
  		insert into board(seq, id, name, email, subject, content, ref) 
  		values (seq_board.nextval, #{id}, #{name}, #{email}, #{subject}, #{content}, seq_board.nextval)
  	</insert>
  	
  	<select id="boardList" parameterType="map" resultType="board">
  		select * from (  select rownum rn, tt.*
				        from (select * from board 
				        order by ref desc, step)tt
				     )
				<![CDATA[ where  rn >= #{startNum} and rn <= #{endNum} ]]>
				
  	</select> 
  	
  	<select id="getTotalA" resultType="int">
  		select count(*) from board
  	</select>
  	
  	<!-- 1개의 글보기 -->
  	<select id="getBoard" parameterType="int" resultType="board">
  		select * from board where seq=#{seq}
  	</select>
  	<update id="updateBoard" parameterType="map">
  		update board set subject=#{subject}, content=#{content}, logtime=sysdate where seq=${seq}
  	</update>
  	<!-- 답글 --> 
  	<!-- step(글순서) update -->
  	<update id="boardReplyStep" parameterType="board">
  		update board set step=step+1 where ref=${ref} and step>${step}
  	</update>
  	<insert id="boardReply" parameterType="map">
  		insert into board(seq, id, name, email, subject, content, ref, lev, step, pseq) 
  		values (seq_board.nextval
  				, #{id}
  				, #{name}
  				, #{email}
  				, #{subject}
  				, #{content}
  				, #{ref}
  				, #{lev}
  				, #{step}
  				, #{pseq})
  	</insert>
  	<update id="boardReplyReply" parameterType="int">
  		update board set reply=reply+1 where seq=#{pseq}
  	</update>
  	
  	<!-- 삭제 -->
  	<update id="deleteBoardReply" parameterType="board">
  		update board set reply=reply-1 where seq=#{pseq}
  	</update>
  	<update id="deleteBoardChildrenSubject" parameterType="board">
  		update board set subject='[원글이 삭제된 답글]'||subject where pseq=#{seq}
  	</update>
  	<delete id="deleteBoard" parameterType="board">
  		delete from board where seq=#{seq}
  	</delete>
  	
  </mapper>
  
  
  
  
  
  
  
  
  